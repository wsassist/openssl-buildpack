#!/bin/sh

set -e

OPENSSL_VERSION=3.3.4
OPENSSL_DIR=$1/.heroku/vendor/openssl

echo "-----> Installing OpenSSL $OPENSSL_VERSION"

mkdir -p $OPENSSL_DIR
cd /tmp

# Download and extract OpenSSL
curl -O https://github.com/openssl/openssl/releases/download/openssl-$OPENSSL_VERSION/openssl-$OPENSSL_VERSION.tar.gz
tar xzf openssl-$OPENSSL_VERSION.tar.gz
cd openssl-$OPENSSL_VERSION

# Configure and install to the app directory
./config --prefix=$OPENSSL_DIR no-shared no-tests > /dev/null
make -s
make install_sw > /dev/null

# Cleanup
cd /tmp
rm -rf openssl-$OPENSSL_VERSION openssl-$OPENSSL_VERSION.tar.gz

echo "-----> OpenSSL installed to $OPENSSL_DIR"